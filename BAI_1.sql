CREATE TABLE KHOA
(
MAKHOA VARCHAR(10) PRIMARY KEY,
TENKHOA VARCHAR(50)
) 

CREATE TABLE LOP
(
MALOP VARCHAR(10) PRIMARY KEY,
TENLOP VARCHAR(10),
SISODK INT,
MAKHOA VARCHAR(10),
FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)
)

CREATE TABLE SINHVIEN
(
MASV VARCHAR(10) PRIMARY KEY,
HOTEN VARCHAR(50),
NGSINH DATE,
DIACHI VARCHAR(50),
GIOITINH VARCHAR(10),
MALOP VARCHAR(10)
FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)
)

CREATE TABLE MONHOC
(
MAMH VARCHAR(10) PRIMARY KEY,
TENMH VARCHAR(10),
SOTIET INT
)

CREATE TABLE KETQUA
(
MASV VARCHAR(10),
MAMH VARCHAR(10),
DIEM INT,
PRIMARY KEY(MASV,MAMH),
FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV),
FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)
)

INSERT INTO KHOA VALUES
('K01','CNTT'),
('K02','DULICH'),
('K03','MAKETING'),
('K04','KT'),
('K05','COKHI')

INSERT INTO LOP VALUES
('L01','CNPM3',60,'K01'),
('L02','CNPM4',50,'K01'),
('L03','DULICH1',80,'K02'),
('L04','MKT1',30,'K03'),
('L05','KTVM',45,'K04'),
('L06','QLKTE',60,'K04'),
('L07','COKHI1',55,'K05'),
('L08','COKHI2',40,'K05')

INSERT INTO SINHVIEN VALUES
('SV01','GIAP','2004/09/15','THAIBINH','NAM','L02'),
('SV02','CHUNG','2007/07/20','THAIBINH','NAM','L02'),
('SV03','THUY','2004/09/15','THANHHOA','NU','L04'),
('SV04','THU','2004/11/12','HANOI','NAM','L05'),
('SV05','NGA','2004/10/19','NHATBAN','NU','L06'),
('SV06','BINH','2001/10/05','THAIBINH','NAM','L01'),
('SV07','HUONG','2007/01/25','HALONG','NU','L03'),
('SV08','NHI','2005/05/07','HAIPHONG','NU','L07'),
('SV09','THAO','2006/09/15','THAIBINH','NU','L06'),
('SV010','SON','2004/10/27','QUANGNINH','NAM','L08')

INSERT INTO MONHOC VALUES
('MH01','TOAN',60),
('MH02','LAPTRINH',40),
('MH03','TIENGANH',50),
('MH04','GDCD',60),
('MH05','SU',20)

INSERT INTO KETQUA VALUES
('SV01','MH01',9),
('SV01','MH05',10),
('SV01','MH03',8),
('SV02','MH01',9),
('SV02','MH04',9),
('SV03','MH03',7),
('SV04','MH05',6),
('SV05','MH01',9),
('SV06','MH03',4),
('SV06','MH05',3),
('SV07','MH02',6),
('SV07','MH03',2),
('SV08','MH03',7),
('SV09','MH03',5),
('SV010','MH05',9)

-- 1 CHO BIET TEN NHUNG MON HOC CO SO TIET >= 30 AND <= 90
SELECT TENMH FROM MONHOC
WHERE SOTIET BETWEEN 30 AND 90

-- 2 CHO BIET TEN SV HOC LOP CMPM4 VA CO DIEM THI TRONG KHOANG TU 6 DEN 10 
-- VI DIEM KHAC NHAU NEN NO SE TAO RA CAC BAN GHI KHAC NHAU ( GIONG TO HOP ) 
-- NEU SELECT DISTINCT HO TEN THI NO CHI RA 2 TEN LA GIAP VA CHUNG THOI 
SELECT DISTINCT HOTEN,DIEM FROM SINHVIEN,LOP,KETQUA
WHERE KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND TENLOP = 'CNPM4'
AND DIEM BETWEEN 6 AND 10
-- NHAP
SELECT * FROM SINHVIEN,LOP,KETQUA
SELECT HOTEN FROM SINHVIEN,LOP,KETQUA
WHERE KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND TENLOP = 'CNPM4'
AND DIEM BETWEEN 6 AND 10
GROUP BY HOTEN

-- 3 CHO BIET TEN MH CO SO TIET < 60 VA DO NHUNG SINH VIEN K01 THEO HOC
-- SU DUNG DISTINCT DE KHONG BI LAP
SELECT DISTINCT TENMH FROM SINHVIEN,MONHOC,LOP,KHOA,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND LOP.MAKHOA = KHOA.MAKHOA
AND KHOA.MAKHOA = 'K01'
AND SOTIET <= 60
-- CAC MON MA SINH VIEN K01 THEO HOC 
SELECT * FROM SINHVIEN,MONHOC,LOP,KHOA,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND LOP.MAKHOA = KHOA.MAKHOA
AND KHOA.MAKHOA = 'K01'
-- HOAC GROUP BY THEO TRUONG TEN CX DC !

-- 4 CHO BIET TEN SV KHOA K01 HOC MON TOAN VOI SO DIEM > 5
SELECT * FROM SINHVIEN,MONHOC,LOP,KHOA,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND LOP.MAKHOA = KHOA.MAKHOA
AND KHOA.MAKHOA = 'K01' 
AND DIEM > 5
AND TENMH = 'TOAN'
-- THUC RA CHI CAN LIEN KET 4 BANG !
SELECT * FROM SINHVIEN,MONHOC,LOP,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND MAKHOA = 'K01' 
AND DIEM > 5
AND TENMH = 'TOAN'
--NHAP
SELECT * FROM SINHVIEN,MONHOC,LOP,KHOA,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND KETQUA.MASV = SINHVIEN.MASV
AND SINHVIEN.MALOP = LOP.MALOP
AND LOP.MAKHOA = KHOA.MAKHOA

-- 5 LIET KE DANH SACH TEN CAC KHOA VA SO LUONG MOI LOP CUA TUNG KHOA 
SELECT TENKHOA,COUNT(*) AS SOLOP FROM LOP,KHOA
WHERE LOP.MAKHOA = KHOA.MAKHOA
GROUP BY TENKHOA
-- TEN CAC LOP VA KHOA TUONG UNG VOI MOI LOP 
SELECT * FROM LOP,KHOA
WHERE LOP.MAKHOA = KHOA.MAKHOA

-- 6 CHO BIET HO TEN SINH VIEN HOC TREN 2 MON
SELECT HOTEN,COUNT(*) AS SOMONHOC FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV
GROUP BY HOTEN 
HAVING COUNT(*) >= 2

-- MA SINH VIEN XUAT HIEN 1 LAN TRONG BANG KETQUA CHUNG TO SINH VIEN AY HOC 1 MON NAO DO 
-- NEU HOC MOI CO DIEM TRONG BANG KET QUA 
-- VAY SO LAN 1 MA SINH VIEN XUAT HIEN TRONG BANG KQ CHINH LA SO MON MA SINH VIEN DO HOC
-- NEN GOM DEM AI TREN 2 LAN CHUNG TO HOC SINH AY HOC TREN 2 MON
SELECT * FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV

-- 7 CHO BIET TEN NHUNG KHOA CO IT NHAT 2 LOP 
SELECT DISTINCT TENKHOA,COUNT(*) AS SOLUONG FROM KHOA,LOP
WHERE LOP.MAKHOA = KHOA.MAKHOA
GROUP BY TENKHOA
HAVING COUNT(*) >= 2
-- CAC LOP VA KHOA TUONG UNG VOI TUNG LOP
SELECT * FROM LOP,KHOA
WHERE LOP.MAKHOA = KHOA.MAKHOA

-- 8 CHO BIET TEN NHUNG LOP CO SI SO THUC >= 3 
SELECT TENLOP,SISODK FROM LOP
WHERE SISODK >= 3

-- 9 CHO BIET TEN NHUNG KHOA CO IT NHAT 100 SV
SELECT TENKHOA,SUM(SISODK) AS TONGSV FROM KHOA,LOP -- HIEN THI THEM SO LUONG SV TRONG MOI KHOA CHO OK
WHERE LOP.MAKHOA = KHOA.MAKHOA
GROUP BY TENKHOA
HAVING SUM(SISODK) >= 100

-- ?
SELECT TENKHOA FROM SINHVIEN,KHOA,LOP
WHERE LOP.MAKHOA = KHOA.MAKHOA
AND SINHVIEN.MALOP = LOP.MALOP
GROUP BY TENKHOA
HAVING COUNT(*) >= 100


-- CAC KHOA VA CAC LOP LOP THUOC CAC KHOA , 1 KHOA CO NHIEU LOP
-- KHOA CO IT NHAT 100 SV => TONG SI SO CUA CAC LOP THUOC KHOA DO >= 100
SELECT * FROM KHOA,LOP
WHERE LOP.MAKHOA = KHOA.MAKHOA

-- 10 CHO BIET TEN NHUNG MON HOC CO SO TIET > 30 VA CO IT NHAT 2 SV THEO HOC 
SELECT TENMH,COUNT (*) AS SOSV FROM MONHOC,KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND SOTIET >= 30
GROUP BY TENMH
HAVING COUNT(*) >= 2
-- MOI MA MH XUAT HIEN TRONG BANG KET QUA CHO THAY CO 1 SINH VIEN THEO HOC
-- VAY 1 MA MON HOC XUAT HIEN N LAN CHUNG TO CO N SINH VIEN DANG THEO HOC
-- NEN NHOM TEN MON HOC > 2 VA CO SO TIET > 30 BOI MOI LAN XUAT HIEN LA CO 1 SV THEO HOC 
SELECT * FROM MONHOC,KETQUA
-- SELECT * FROM KETQUA
WHERE MONHOC.MAMH = KETQUA.MAMH
AND SOTIET >= 30

-- 11 TEN NHUNG MON HOC CO SO TIET MAX 
SELECT TENMH,SOTIET FROM MONHOC
WHERE SOTIET = (SELECT MAX(SOTIET) FROM MONHOC)  -- HOAC DUNG ALL
-- CHECK
SELECT * FROM MONHOC

-- 12 CHO BIET TEN NHUNG SV HOC NHIEU MON NHAT 
-- NHOM SINH VIEN ROI DUNG COUNT XEM AI CO SO LAN MAX CHINH LA NGUOI CO SO MON HOC NHIEU NHAT
-- SAU KHI NHOM THI SO LUONG MON HOC CUA TUNG NGUOI SE XUAT HIEN O COT SOMON MA MIINH DA TAO
-- DUNG ORDER BY DE XAP XEP THEO THU TU GIAM DAN => TOP 1 SE LA NGUOI CO SO MON HOC LON NHAT
SELECT TOP 1 HOTEN,COUNT(*) AS SOMON FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV
GROUP BY HOTEN
ORDER BY SOMON DESC
-- SO LAN SV XUAT HIEN TRONG BANG KET QUA CX CHINH LA SO MON MA HOC SINH DO DANG THEO HOC
SELECT * FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV

-- 13 CHO BIET TEN NHUNG MON HOC CO NHIEU SINH VIEN THEO HOC NHAT 
SELECT TOP 1 TENMH,COUNT(*) AS SOLUONG FROM KETQUA,MONHOC
WHERE KETQUA.MAMH = MONHOC.MAMH
GROUP BY TENMH
ORDER BY SOLUONG DESC
-- SO LAN 1 MA MON HOC NAO DO XUAT HIEN TRONG BANG KET QUA CX CHINH LA SO SV DANG THEO HOC MON DO 
-- MA NAO XUAT HIEN NHIEU NHAT TRONG BANG KET QUA THI MA MON HOC DO CO NHIEU SV HOC NHAT 
-- CO MA MON HOC TU DO => TEN MON HOC 
SELECT * FROM KETQUA,MONHOC
WHERE KETQUA.MAMH = MONHOC.MAMH

-- 14 LIET KE CAC DANH SACH MON HOC MA CHUA CO SV NAO THEO HOC
-- TEN MON HOC TRONG BANG MON HOC KO XUAT HIEN O BANG KET QUA THI CHUNG TO MON DO KO CO SV DK
-- CHINH VI THE NEN MON DO SE KO CO KET QUA CUA THI SINH TRONG BANG KET QUA
SELECT TENMH FROM MONHOC
WHERE TENMH NOT IN (
	SELECT TENMH FROM KETQUA
)
-- CAC MA MON HOC XUAT HIEN TRONG BANG KET QUA CHINH LA CAC MA MON HOC MA CO SV DANG THEO HOC
-- => NHUNG MA MON HOC O BANG MON HOC MA KO XUAT HIEN O BANG KET QUA CHINH LA MA MON HOC KO CO SV HOC
-- CO MA MON HOC KHONG CO SV HOC => TEM MON HOC KHONG CO SINH VIEN THEO HOC
SELECT * FROM KETQUA,MONHOC
WHERE KETQUA.MAMH = MONHOC.MAMH

-- 15 LIET KE MASV,HOTEN CUA NHUNG SV NU CO DIEM TRUNG BINH CAO NHAT 
-- CHU YS TRUONG NAO XUAT HIEN O CA 2 BANG THI PHAI GHI RO COT THUOC BANG NAO <TENBANG.TENCOT>
SELECT TOP 1 SINHVIEN.MASV,HOTEN,AVG(DIEM) AS DIEMTB FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV
AND GIOITINH = 'NU'
GROUP BY HOTEN,SINHVIEN.MASV
ORDER BY DIEMTB DESC 

-- SINH VIEN NU VA KET QUA THI CAC MON UNG VOI TUNG SINH VIEN NU DO
SELECT * FROM SINHVIEN,KETQUA
WHERE SINHVIEN.MASV = KETQUA.MASV
AND GIOITINH = 'NU'
