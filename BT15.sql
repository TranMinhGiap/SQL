CREATE TABLE CHUCVU(
 MACV CHAR(30) PRIMARY KEY,
 TENCV CHAR(30),
 HESOPC FLOAT,
 )
CREATE TABLE NHANVIEN(
  MANV CHAR(30) PRIMARY KEY,
  TENNV CHAR(30),
  DIACHI CHAR(30),
  HESOLUONG FLOAT,
  MACV CHAR(30) REFERENCES CHUCVU(MACV),
  MAPH CHAR(30) REFERENCES PHONG(MAPH),
  LUONG CHAR(30),
  THUCLINH FLOAT,
  )
CREATE TABLE PHONG(
 MAPH CHAR(30) PRIMARY KEY,
 TENPH CHAR(30),
 DIACHIPH CHAR(30),
 )
 INSERT INTO CHUCVU VALUES
('CV01','GIAM DOC',10),
('CV02','TRUONG PHONG',9),
('CV03','BAO VE',2),
('CV04','NHAN VIEN',5),
('CV05','PHO GIAM DOC',10)
GO
INSERT INTO PHONG VALUES
('PH01','PHONG GIAM DOC','TANG5'),
('PH02','PHONG LAM VIEC','TANG4'),
('PH03','PHONG TRUC BAN','TANG3'),
('PH04','PHONG QUAN LY','TANG2'),
('PH05','PHONG BAO VE','TANG1')
GO
INSERT INTO NHANVIEN VALUES
('NV01','NGUYEN TRONG THANH','HAI PHONG',30,'CV02','PH02',1500,1400),
('NV02','NGUYEN THU HUONG','HA LONG',7,'CV04','PH04',900,750),
('NV03','TRAN MINH GIAP','THAI BINH',25,'CV01','PH01',500,400),
('NV04','NGUYEN THI BINH','VU THU',12,'CV04','PH02',500,400),
('NV05','NGUYEN THU HUONG','THAI BINH',18,'CV04','PH02',500,400),
('NV06','TRAN VAN BINH','THAI BINH',10,'CV05','PH03',500,400),
('NV07','PHAM THI THUY','THANH HOA',7,'CV02','PH02',500,400),
('NV08','DANG YEN NHI','DA NANG',5,'CV02','PH03',500,400),
('NV09','TRAN THANH HUYEN','HUE',22,'CV05','PH04',500,400),
('NV010','TRAN NGOC TRINH','SAI GON',16,'CV02','PH04',500,400)
SELECT PHONG.TENPH,PHONG.MAPH FROM NHANVIEN,PHONG
WHERE NHANVIEN.MAPH = PHONG.MAPH
GROUP BY PHONG.TENPH,PHONG.MAPH
HAVING COUNT(*) > 3
CREATE RULE R1
AS @HESOLUONG BETWEEN 3 AND 9
EXEC sp_bindrule 'R1', 'NHANVIEN.HESOLUONG'
--TT TINH LUONG CUA NV THEO CT LUONG = HSLUONG*2
CREATE PROC PR1
AS UPDATE NHANVIEN
SET LUONG = HESOLUONG*2

EXEC PR1
-- KTRA LUONG LON HON 18
ALTER TRIGGER TG1 ON NHANVIEN
FOR UPDATE
AS
BEGIN
 IF ((SELECT THUCLINH FROM inserted) <0 )
  BEGIN
   PRINT('THUC LINH LON HON 0')
   ROLLBACK TRAN
  END
END

